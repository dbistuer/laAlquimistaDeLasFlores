{% extends "navbar.html" %}
{% load i18n %}

{% block content %}
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card mt-5">
                    <div class="card-header text-center">
                        <h4>{% trans "User Registration" %}</h4>
                    </div>
                    <div class="card-body">
                        <form id="registrationForm" method="post">
                            {% csrf_token %}
                            <div class="form-group">
                                <label for="username">{% trans "Username" %}</label>
                                <input type="text" class="form-control" id="username" name="username" placeholder={% trans "Enter username" %} required>
                            </div>
                            <div class="form-group">
                                <label for="first_name">{% trans "First name" %}</label>
                                <input type="text" class="form-control" id="first_name" name="first_name" placeholder={% trans "Enter first name" %} required>
                            </div>
                            <div class="form-group">
                                <label for="last_name">{% trans "Last name" %}</label>
                                <input type="text" class="form-control" id="last_name" name="last_name" placeholder={% trans "Enter last name" %} required>
                            </div>
                            <div class="form-check form-check-inline">
                              <input class="form-check-input" type="radio" id="NIF" name=NIF" value="NIF">
                              <label class="form-check-label" for="NIF">NIF</label>
                            </div>
                            <div class="form-check form-check-inline">
                              <input class="form-check-input" type="radio" id="NIE" name="NIE" value="NIE">
                              <label class="form-check-label" for="NIE">NIE</label>
                            </div>
                            <div class="form-group">
                                <label for="identification">{% trans "Identification" %}</label>
                                <input type="text" class="form-control" id="identification" name="identification" placeholder={% trans "Enter identification" %} required>
                            </div>
                            <div class="form-group">
                                <label for="phone">{% trans "Phone" %}</label>
                                <input type="text" class="form-control" id="phone" name="phone" placeholder={% trans "Enter phone number" %}>
                            </div>
                            <div class="form-group">
                                <label for="email">{% trans "Email address" %}</label>
                                <input type="email" class="form-control" id="email" name="email" placeholder={% trans "Enter email" %} required>
                            </div>
                            <div class="form-group">
                                <label for="password">{% trans "Password" %}</label>
                                <input type="password" class="form-control" id="password" name="password" placeholder={% trans "Enter password" %} required>
                            </div>
                            <div class="progress" style="height: 20px;">
                              <div class="progress-bar" role="progressbar" id="progressbar" style="width: 0%;" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                            <div class="form-group">
                                <label for="confirmPassword">{% trans "Confirm Password" %}</label>
                                <input type="password" class="form-control" id="confirmPassword" placeholder={% trans "Repeat password" %} required>
                            </div>
                            <div id="passwordError" class="text-danger" style="display: none;">{% trans "Passwords do not match" %}</div>
                            <button type="submit" id="submit" disabled class="btn btn-primary btn-block">{% trans "Register" %}</button>
                        </form>
                    </div>
                    <div class="card-footer text-center">
                        <small>&copy; 2024 LaAlquimistaDeLasFlores</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
{% block javascript %}
<script>
        var progressbar= document.getElementById("meter");
        var password = document.getElementById('password');
        var confirmPassword = document.getElementById('confirmPassword');
        var submit = document.getElementById('submit');
        password.onkeyup = checkPassword(password.value);
        confirmPassword.onkeyup = verifyPassword();

        function getStrength(password){
            var strength=0;
            if (password.match(/[a-z]+/)){      strength+=1; }
            if (password.match(/[A-Z]+/)){      strength+=1; }
            if (password.match(/[0-9]+/)){      strength+=1; }
            if (password.match(/[!|"@·#$~€%&¬/()=?¿'¡{},.;:_*+]+/)){    strength+=1; }
            if(password.length >= 8){ strength+=1; }
            return strength;
        }
        
        function setProgressBar(progressbar, value,class_name){
            progressbar.style = "width: "+value+"%;";
            progressbar.classList.remove("bg-danger","bg-warning","bg-info","bg-success");
            progressbar.classList.add(class_name);
        }
        
        function checkPassword(password)
        {
            switch(getStrength(password)){
            case 0:
                setProgressBar(progressbar,0,"bg-danger");
                break;
            case 1:
                setProgressBar(progressbar,20,"bg-danger");
                break;
            case 2:
                setProgressBar(progressbar,40,"bg-warning");
                break;
            case 3:
                setProgressBar(progressbar,60,"bg-info");
                break;
            case 4:
                setProgressBar(progressbar,80,"bg-info");
                break;
            case 5:
                setProgressBar(progressbar,100,"bg-success");
                break; }
        }
        
        function verifyPassword() {
            let match = true;
            error = document.getElementById('passwordError');
            if (password != confirmPassword && getStrength(password) == 5) {
                setInputBorderColor(password, "#ff0000");
                setInputBorderColor(confirmPassword, "#ff0000");
                error.style.display = 'block';
                submit.disabled = true;
                match = false;
            }
            else {
                setInputBorderColor(password, "#ff0000");
                setInputBorderColor(confirmPassword, "#ff0000");
                submit.disabled = false;
                error.style.display = 'none';
            }
            return match;
        }
        
        function setInputBorderColor(input, color){
            input.style.borderColor = class_name;
        }
    </script>
{% endblock %}